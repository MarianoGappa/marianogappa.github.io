<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>untitled &#8211; Mariano Gappa's Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="TODO">
    <meta name="author" content="Mariano Gappa">
    <meta name="keywords" content="software">
    <link rel="canonical" href="http://marianogappa.github.io/software/2017/05/15/untitled/">
    <link rel="alternate" type="application/rss+xml" title="RSS Feed for Mariano Gappa's Blog" href="/feed.xml" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/pixyll.css?201705151939" type="text/css">

    <!-- Fonts -->
    <link href='//fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Lato:900,300' rel='stylesheet' type='text/css'>
    
      <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    

    <!-- Verifications -->
    

    <!-- Open Graph -->
    <!-- From: https://github.com/mmistakes/hpstr-jekyll-theme/blob/master/_includes/head.html -->
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:title" content="untitled">
    <meta property="og:description" content="Blog about Software Engineering and Music Production.">
    <meta property="og:url" content="http://marianogappa.github.io/software/2017/05/15/untitled/">
    <meta property="og:site_name" content="Mariano Gappa's Blog">
    

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    
        <meta name="twitter:site" content="@MarianoGappa" />
    
    <meta name="twitter:title" content="untitled" />
    <meta name="twitter:description" content="TODO" />
    <meta name="twitter:url" content="http://marianogappa.github.io/software/2017/05/15/untitled/" />

    <!-- Icons -->
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-160x160.png" sizes="160x160">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">

    <!-- Added by Mariano for syntax highlighting -->
    <link href="/css/syntax.css" rel="stylesheet">

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-58930438-4', 'auto');
  ga('send', 'pageview');

    </script>
</head>

<body class="site animated fade-in-down">
  <div class="site-wrap">
    <header class="site-header px2 px-responsive">
  <div class="mt2 wrap">
    <div class="measure">
      <a href="http://marianogappa.github.io" class="site-title">Mariano Gappa's Blog</a>
      <nav class="site-nav">
        <a href="/about/">About</a>
<a href="/contact/">Contact</a>
<a href="http://www.gappamixing.com">Mixing</a>

      </nav>
      <div class="clearfix"></div>
      
        <div class="social-icons">
  <div class="left">
    
      <a class="fa fa-github" href="https://github.com/MarianoGappa"></a>
    
    
    
    <a class="fa fa-rss" href="/feed.xml"></a>
    
      <a class="fa fa-twitter" href="https://twitter.com/MarianoGappa"></a>
    
    
    
      <a class="fa fa-envelope" href="mailto:mariano.gappa@gmail.com"></a>
    
    
    
    
  </div>
  <div class="right">
    
    
    
  </div>
</div>
<div class="clearfix"></div>

      
    </div>
  </div>
</header>


    <div class="post p2 p-responsive wrap" role="main">
      <div class="measure">
        


<div class="post-header mb2">
  <h1>untitled</h1>
  
  <span class="post-meta">May 15, 2017</span><br>
  
  <span class="post-meta small">
  
    14 minute read
  
  </span>
</div>

<article class="post-content">
  <h2 id="tldr">TL;DR</h2>

<p>Since we began our <a href="https://movio.co/blog/migrate-Scala-to-Go/">transition from Scala to Go</a>, we suddenly discovered that when there’s no right tool for the job, we can make a rough one ourselves in an hour or two, and then if it makes sense we can iterate on it until it becomes something the whole team can use, then the whole company, and then sometimes even the whole world. The keys are to keep it simple and to only code for the use cases that we’re actually gonna use; the extra features are just time wasted on bugs waiting to be found.</p>

<p>In this blogpost, I’d like to share two of these tools: <a href="https://github.com/marianogappa/sql">sql</a> and <a href="https://github.com/marianogappa/chart">chart</a>, that we’ve been using a lot lately and that together compose an interesting pattern for tinkering with multiple databases individually or concurrently within the terminal.</p>

<h1 id="introduction">Introduction</h1>

<p>Being part of Movio Cinema’s Red Squad has been an interesting and challenging journey so far.</p>

<p>The Movio Cinema SaaS platform has grown to manage the marketing campaigns of almost 60 of the biggest cinema chains worldwide in only a few years. This feat has not come without a few interesting challenges.</p>

<p>In the early days it was relatively easy to provide good quality support on a timely manner with minimum developer resources. Recently it has become necessary to get creative to accomodate the volume of incoming support tickets, without sacrificing proactive support and the development of new and exciting projects. This effort has not been exclusive to the dev team; the whole organisation has stepped up on this regard as well.</p>

<p>When presented with a support situation, sometimes outside office hours, it’s important to diagnose quickly. Given the nature of our issues, much of our support work takes place in the terminal, and our toolbox is based on <a href="https://www.gnu.org/software/coreutils/coreutils.html">Linux’s coreutils</a>. Most of the time, we’re working with remote MySQL databases, Cassandra clusters, Kafka clusters and hundreds of microservices deployed as Kubernetes pods onto several AWS data centers and availability zones.</p>

<p>Almost everything that we are required to do to maintain this infrastructure and resolve support issues can be achieved by a clever composition of coreutils, following <a href="https://en.wikipedia.org/wiki/Unix_philosophy">the UNIX philosophy</a>. Over time, common patterns have evolved into scripts and tools.</p>

<h2 id="an-example-of-how-we-compose-coreutils">An example of how we compose coreutils</h2>

<p>When a new member joins our squad, we give him the “owner” bash function so he can figure out who to ask for a brief explanation about what a particular microservice does:</p>

<div class="language-sh highlighter-rouge"><pre class="highlight"><code><span class="k">function </span>owner <span class="o">()</span> <span class="o">{</span>
    <span class="nb">echo</span> <span class="nv">$1</span>;
    git log --pretty<span class="o">=</span>short -- <span class="nv">$1</span> | grep Author: | cut -f 2 -d <span class="s1">' '</span> | sort | uniq -c | sort -rn;
    <span class="nb">echo</span>
<span class="o">}</span>
</code></pre>
</div>

<p>Which shows who authored the most commits on some folder under git:</p>

<div class="language-sh highlighter-rouge"><pre class="highlight"><code>~/Code/monolith <span class="nv">$ </span>owner

 882 Jonathan
 873 Mariano
 780 Sebastian
 760 Peter
 ...
</code></pre>
</div>

<h2 id="growing-the-toolbox">Growing the toolbox</h2>

<p>Over time, we’ve incorporated several tools into this swiss-army knife. Notable examples are <a href="https://github.com/ggreer/the_silver_searcher">The Silver Searcher</a> for fast grepping and <a href="https://stedolan.github.io/jq/">jq</a> for parsing JSON.</p>

<h2 id="what-about-mysql">What about MySQL?</h2>

<p>When working with MySQL, however, for years we have lacked these sorts of practical ad-hoc interactions. Why was MySQL different?</p>

<p>The MySQL client is not intended primarily for composability, given:</p>

<ol>
  <li>the database we’re interested in generally runs on a remote machine</li>
  <li>the mysql client is interactive</li>
  <li>it outputs results in a format that makes it hard to use</li>
</ol>

<p>Here’s a query ran on a MariaDB client:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>MariaDB [test]&gt; SELECT * FROM (SELECT 1, 2, 3) t;
+---+---+---+
| 1 | 2 | 3 |
+---+---+---+
| 1 | 2 | 3 |
+---+---+---+
1 row in set (0.00 sec)
</code></pre>
</div>

<p>We can work around these impediments:</p>

<ol>
  <li><code class="highlighter-rouge">mysql</code> obviously allows us to connect to a remote database, provided you <a href="https://dev.mysql.com/doc/refman/5.7/en/grant.html">grant the appropriate permissions</a> to the user within the MySQL server and allow the remote incoming connection on the server’s firewall.</li>
</ol>

<div class="highlighter-rouge"><pre class="highlight"><code>$ mysql -h remote.movio.co -P3306 -u mariano -pmypass db
</code></pre>
</div>

<ol>
  <li>We can use the <code class="highlighter-rouge">-e</code> flag to supply a query to the client. When this flag is supplied, the client is not interactive</li>
</ol>

<div class="highlighter-rouge"><pre class="highlight"><code>$ mysql -h remote.movio.co -P3306 -u mariano -pmypass db -e"SELECT * FROM (SELECT 1, 2, 3) t"
+---+---+---+
| 1 | 2 | 3 |
+---+---+---+
| 1 | 2 | 3 |
+---+---+---+
</code></pre>
</div>

<ol>
  <li>To get an output we can use, we can add the -N (skip column names), -s (silent, less output) and -r (raw output, tabular format) flags</li>
</ol>

<div class="highlighter-rouge"><pre class="highlight"><code>$ mysql -h remote.movio.co -P3306 -u mariano -pmypass db -Nsre"SELECT * FROM (SELECT 1, 2, 3) t"
1 2 3
</code></pre>
</div>

<p>That’s much better; we can now, as an example, compose with <code class="highlighter-rouge">bc</code> to sum them up:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ mysql -h remote.movio.co -P3306 -u mariano -pmypass db -Nsre"SELECT * FROM (SELECT 1, 2, 3) t" | tr "\t" "+" | bc
6
</code></pre>
</div>

<p>Even though we can now apply the whole coreutils toolbox on the output of any query, there are still two important issues with this approach:</p>

<ol>
  <li>The previous line is way too long to be convenient for ad-hoc experiments.</li>
  <li>The production database password is all over the bash history file.</li>
</ol>

<p>We can solve both issues with a bash function:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span><span class="k">function </span>m<span class="o">()</span> <span class="o">{</span>
    mysql -h remote.movio.co -P3306 -u mariano -pmypass db -Nsre<span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>
<span class="o">}</span>
</code></pre>
</div>

<p>And then we can just:
<code class="highlighter-rouge">bash
$ m 'SELECT * FROM (SELECT 1, 2, 3) t' | tr "\t" "+" | bc
6
</code></p>

<p>But this idea has two new issues:</p>

<ol>
  <li>It works fine as long as we don’t forget that we can’t use double quotes in the query.</li>
  <li>It only works for a specific database; if we want to query a different one, we need either another function or some parameter.</li>
</ol>

<h2 id="enter-sql">Enter sql</h2>

<p>Hoping to address all these issues, we built a ridiculously simple Go CLI tool called <a href="https://github.com/marianogappa/sql">sql</a>. At the time of this writing it was basically a ~200 LoC main.go.</p>

<p><code class="highlighter-rouge">sql</code> reads STDIN until an EOF (it assumes the content is a MySQL query) and then sends the query to one or many databases, and outputs the results in a tabulated format to STDOUT.</p>

<p>Thus, the previous example would look like this on <code class="highlighter-rouge">sql</code>:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span><span class="nb">echo</span> <span class="s2">"SELECT * FROM (SELECT 1, 2, 3) t"</span> | sql remote | tr <span class="s2">"</span><span class="se">\t</span><span class="s2">"</span> <span class="s2">"+"</span> | bc
6
</code></pre>
</div>

<p>It requires a configuration file with the database locations and credentials. The previous example assumes you have a configuration file that looks like this:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="o">{</span>
  <span class="s2">"remote"</span>: <span class="o">{</span>
    <span class="s2">"dbName"</span>: <span class="s2">"db"</span>,
    <span class="s2">"dbServer"</span>: <span class="s2">"remote.movio.co"</span>,
    <span class="s2">"pass"</span>: <span class="s2">"mypass"</span>,
    <span class="s2">"user"</span>: <span class="s2">"mariano"</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>It can query multiple databases in parallel (using goroutines). To disambiguate output when multiple databases are queried (which doesn’t necessarily come sorted), the database name is added as the first column of each line.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>sql remote1 remote2 <span class="o">&lt;&lt;&lt;</span> <span class="s2">"SELECT name FROM red_squad ORDER BY id DESC LIMIT 3"</span>
remote1	Lucian
remote2	Isaac
remote1	Gary
remote1	Mariano
remote2	Mikhail
remote2	Am
</code></pre>
</div>

<p>Use <code class="highlighter-rouge">sql all</code> to query all the databases in your configuration file.</p>

<p>It additionally supports the case where your local machine doesn’t have permission to connect remotely but some application server does; in this case <code class="highlighter-rouge">sql</code> will first <code class="highlighter-rouge">ssh</code> to the app server and then connect to <code class="highlighter-rouge">mysql</code>.</p>

<p><img src="http://marianogappa.github.io/images/sql.png" alt="sql diagram" /></p>

<p>Note that <code class="highlighter-rouge">sql</code> depends on the <code class="highlighter-rouge">mysql</code> client and optionally <code class="highlighter-rouge">ssh</code>. When <code class="highlighter-rouge">ssh</code> is used, the <code class="highlighter-rouge">mysql</code> client must exist in the remote server; not in your local machine.</p>

<h2 id="what-happened-next">What happened next</h2>

<p>While this shiny new tool made querying faster and more convenient in some cases (e.g. not needing to ssh to a remote host, not having to type hostnames and username/password), it also enabled some important new ones, like being able to compare or assert something across many or all of our databases.</p>

<p>In doing so, we found that sometimes the result of a query, multitentanted or not, is not easy to interpret in plain text. Sometimes charts are better than data tables for humans.</p>

<h2 id="heres-an-example-that-we-have-come-across">Here’s an example that we have come across</h2>

<p>At Movio, we send hundreds of millions of emails. Every once in a while, something goes wrong with some marketing campaign, and we need to figure out what happened, fast. In this example case, we suspect some email provider is rejecting our emails.</p>

<p>Let’s say we have the following table (one of these on each of dozens of mailservers) to track email send attempts:</p>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">SentEmails</span> <span class="p">(</span>
    <span class="n">email</span> <span class="n">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">success</span> <span class="n">TINYINT</span><span class="p">,</span>
    <span class="n">utcSent</span> <span class="k">TIMESTAMP</span>
<span class="p">)</span>
</code></pre>
</div>

<p>An intuitive query to find the latest failed attempts in the last 7 days would be:</p>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="n">email</span> <span class="k">FROM</span> <span class="n">SentEmails</span>
  <span class="k">WHERE</span> <span class="n">success</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">AND</span> <span class="n">utcSent</span> <span class="o">&gt;</span> <span class="n">DATE_SUB</span><span class="p">(</span><span class="n">UTC_TIMESTAMP</span><span class="p">(),</span> <span class="n">INTERVAL</span> <span class="mi">7</span> <span class="k">DAY</span><span class="p">)</span>
</code></pre>
</div>

<p>Thanks to <code class="highlighter-rouge">sql</code>, we can run it concurrently on all mailservers:
(these have been randomly generated using an <a href="https://www.randomlists.com">online tool</a>)</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span><span class="nb">echo</span> <span class="s1">'SELECT email FROM ...'</span> | sql all
mail1_db	mthurn@live.com
mail15_db	fangorn@hotmail.com
mail6_db	euice@outlook.com
mail1_db	rgarcia@optonline.net
mail8_db	mxiao@yahoo.com
...
</code></pre>
</div>

<p>Let’s extract the domains:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span><span class="nb">echo</span> <span class="s1">'SELECT email FROM ...'</span> | sql all | awk <span class="s1">'{print $2}'</span> | grep -o @.<span class="k">*</span>
@live.com
@hotmail.com
@outlook.com
@optonline.net
@yahoo.com
...
</code></pre>
</div>

<p>If we’re gonna tinker a lot with the exact same query, piping the result to a file and <code class="highlighter-rouge">cat</code>ting it would be a lot more responsible:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span><span class="nb">echo</span> <span class="s1">'SELECT email FROM ...'</span> | sql all | awk <span class="s1">'{print $2}'</span> &gt; result
</code></pre>
</div>

<p>Now we can do some coreutils magic to count the domain appearances:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>cat result | grep -o @.<span class="k">*</span> | sort | uniq -c | sort -rn | head -n5
13845 @yahoo.com
 1505 @hotmail.com
 1312 @outlook.com
 1287 @live.com
 1231 @optonline.net
...
</code></pre>
</div>

<p>Eureka! Yahoo must be blocking us temporarily for some reason. Note that, without <code class="highlighter-rouge">sql</code>, it would have been quite laborious to reach this conclusion.</p>

<p>Is this the full picture though? How many results did we leave out?</p>

<h2 id="enter-chart">Enter chart</h2>

<p>Linux has a world-class charting tool called <a href="http://www.gnuplot.info/">gnuplot</a>. It’s very complete and super powerful, but it’s also quite inconvenient for quick ad-hoc charting. It’s <a href="http://www.gnuplot.info/docs_4.0/gpcard.pdf">way too hard to learn</a>. I must admit I haven’t given it a fair shot; complexity scares me.</p>

<p>Instead, we built a very simple charting tool called <a href="https://github.com/marianogappa/chart">chart</a>. It reads data from STDIN (e.g. the output from <code class="highlighter-rouge">sql</code>), figures out the format and opens a browser tab with a chart fitting the data.</p>

<p><code class="highlighter-rouge">chart</code> has only a very limited set of smarts and modifiers. Again: the key is to keep it simple and to only implement what we use.</p>

<p>In the above example, we’d like to see a pie chart of domain frequencies. Since this is such a common use case, when <code class="highlighter-rouge">chart</code> receives a list of strings it will calculate frequency and make a pie chart, adding an “Other” category for the aggregated less frequent ones.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>cat result | grep -o @.* | chart
</code></pre>
</div>

<p><img src="http://marianogappa.github.io/images/chart1.png" alt="Chart with bigger Other slice" /></p>

<p>Interesting! Even though <code class="highlighter-rouge">@yahoo.com</code> seems like the most likely culprit, it is much less representative of the pool of emails sent than we previously thought.</p>

<p>Let’s go back a few steps. Somewhere along the road we decided to ignore the first column of the output (with <code class="highlighter-rouge">awk '{print $2}'</code>). This column was the database name, which corresponds to a mailserver.</p>

<p>Maybe the culprit is a mailserver instead?</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span><span class="nb">echo</span> <span class="s1">'SELECT email FROM ...'</span> | sql all | awk <span class="s1">'{print $1}'</span> | chart
</code></pre>
</div>

<p><img src="http://marianogappa.github.io/images/chart2.png" alt="Chart with particular mailserver" /></p>

<p>Ah! One of our mailservers has been blacklisted! After seeing this, we might go back to check that perhaps more emails failed to be sent to yahoo just because we sent a lot more emails to yahoo accounts in the first place, or maybe they just bounce more often that other domains, or both.</p>

<p>Hopefully you can appreciate the advantages of this workflow:</p>

<ol>
  <li>Being able to query all databases at once made it possible to detect the offending mailserver. Otherwise we might have checked only one or two (i.e. looking at “a sample”) and overlooked the root cause.</li>
  <li>Rather than looking at the top domains using <code class="highlighter-rouge">head -n5</code> because otherwise there would be simply too much output to read, we got a pie chart with an aggregated “Others” slice that revealed a fact concealed by that <code class="highlighter-rouge">head -n5</code>: the domain pool was very diverse, so looking at the top 5 was not very representative of the total.</li>
  <li>We touched on the surface of what this allows. Think of the wealth of tools in coreutils, and what other chart types can reveal. Pie and bar charts can be summarised quite well on simple tables; but line charts and scatter plots can show complex correlations that are invisible on matrices for humans.</li>
</ol>

<h2 id="gotchas">Gotchas</h2>

<p>If you plan to try <code class="highlighter-rouge">sql</code> and <code class="highlighter-rouge">chart</code> for your workflow, you should probably read this section first.</p>

<h3 id="read-only-is-best">Read-only is best</h3>

<p><code class="highlighter-rouge">sql</code> should be used with care; especially against multiple databases. Everyone makes mistakes, and <code class="highlighter-rouge">sql</code> allows you to multiply the destructive power of yours! If you don’t have it already, create a database username with read-only permissions, and use this one with <code class="highlighter-rouge">sql</code>.</p>

<h3 id="even-read-only-can-be-dangerous">Even read-only can be dangerous</h3>

<p>Remember that MyISAM tables will perform a <a href="https://dev.mysql.com/doc/refman/5.7/en/internal-locking.html#internal-table-level-locking">table-level lock on reads</a>. Even on InnoDB, please don’t <code class="highlighter-rouge">SELECT * FROM users</code> on your entire set of databases!</p>

<h3 id="timing-queries">Timing queries</h3>

<p><code class="highlighter-rouge">sql</code> doesn’t output query running time like the mysql client does. However, you can use the <code class="highlighter-rouge">time</code> coreutils tool like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>time sql test_db &lt;&lt;&lt; "SELECT COUNT(*) FROM users"

real    0m6.624s
user    0m0.020s
sys     0m0.034s
</code></pre>
</div>

<p>Note that these figures include the whole time spent by the <code class="highlighter-rouge">sql</code> process, including outputting to STDOUT, which the <code class="highlighter-rouge">mysql</code> client doesn’t include.</p>

<h3 id="watching-show-processlist">Watching SHOW PROCESSLIST</h3>

<p>If you want to double-check that a query is running on some database server, <code class="highlighter-rouge">sql</code> gives you an easy way to inspect queries running for that schema:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>watch "echo 'show processlist' | sql my_db"
</code></pre>
</div>

<p>Which you can further grep to wait for your specific query:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>watch "echo 'show processlist' | sql my_db | grep 'FROM my_table'"
</code></pre>
</div>

<h3 id="learning-chart-should-be-very-easy">Learning chart should be very easy</h3>

<p><code class="highlighter-rouge">chart</code> encourages you to learn on demand and by example.
There are 3 simple ways to learn how to use it:</p>

<ol>
  <li>Look at the <a href="https://marianogappa.github.io/chart/">cheatsheet</a>. Shows example data, commands ran and resulting chart for common use cases.</li>
  <li>Try it! Pipe your data to chart and try the few available options.</li>
  <li>Distrust it. Add the <code class="highlighter-rouge">--debug</code> option to check how <code class="highlighter-rouge">chart</code> interpreted your output. You’ll get an intuition for how it works.</li>
</ol>

<p>The cheatsheet is produced by a Go test file and it’s updated on every automated release, so there’s no way it can get outdated. It’s a pretty solid piece of documentation!</p>

<h3 id="charting-mysql-dates">Charting MySQL dates</h3>

<p><code class="highlighter-rouge">chart</code> uses ChartJS to produce the final chart (which in turn uses MomentJS) and therefore supports plotting dates (although only in the x-axis, as per ChartJS’s limitation). However, in order to understand dates, one has to supply the date format as a parameter to <code class="highlighter-rouge">chart</code>:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>cat dates.csv | chart line --date-format <span class="s1">'2006-01-02 15:04:05'</span>
</code></pre>
</div>

<p>Because it’s so common to use MySQL’s date format, <code class="highlighter-rouge">chart</code> has a special modifier:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>cat dates.csv | chart line mysql
</code></pre>
</div>

<h2 id="closing-thoughts">Closing thoughts</h2>

<p>With <code class="highlighter-rouge">sql</code> and <code class="highlighter-rouge">chart</code>, we’ve found a convenient pattern for quickly diagnosing our support issues. If your work revolves around databases, I think it might be useful for you. Data scientists might draw a parallel to using matplotlib on Jupyter Notebooks.</p>

<p>Currently, only MySQL is supported. It looks like adding support for PostgreSQL, for example, would be a 2 hour job. However, I’m not planning on it, because we wouldn’t be able to test it on a daily basis like we do with MySQL nowadays. But you can! <code class="highlighter-rouge">sql</code> and <code class="highlighter-rouge">chart</code> are <a href="https://github.com/marianogappa/sql#contribute">open</a> for <a href="https://github.com/marianogappa/chart#contribute">contributions</a>.</p>

<p>In the same vein, <code class="highlighter-rouge">chart</code> will probably not support complex use cases. In those cases you’re better off with gnuplot, Excel or Google Sheets; use the right tool for the job.</p>

<p><code class="highlighter-rouge">sql</code> and <code class="highlighter-rouge">chart</code> are free and open source. We hope you find them useful! If you can, please help us to keep them simple and useful as time goes on and we face new interesting challenges. Thank you for reading this blogpost. KISS!</p>

</article>


  <div class="share-page">
  

  <div class="share-links">
    

    
      <a class="fa fa-twitter" href="https://twitter.com/intent/tweet?text=untitled&url=http://marianogappa.github.io/software/2017/05/15/untitled/" rel="nofollow" target="_blank" title="Share on Twitter"></a>
    

    

    

    

    

    
      <a class="fa fa-reddit" href="http://reddit.com/submit?url=http://marianogappa.github.io/software/2017/05/15/untitled/&title=untitled" rel="nofollow" target="_blank" title="Share on Reddit"></a>
    

    

    
      <a class = "fa fa-hacker-news" onclick="parent.postMessage('submit','*')" href="https://news.ycombinator.com/submitlink?u=http://marianogappa.github.io/software/2017/05/15/untitled/&t=untitled" rel="nofollow" target="_blank" title="Share on Hacker News"></a>
    


  </div>
</div>






  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_shortname  = 'marianogappasblog';
    var disqus_identifier = '/software/2017/05/15/untitled';
    var disqus_title      = '';

    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>




      </div>
    </div>
  </div>

  
</body>
</html>
